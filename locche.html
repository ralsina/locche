<html>
<head>
<title>Locche!</title>
<link type="text/css" rel="stylesheet" href="http://cdn.jsdelivr.net/codemirror/3.14.0/codemirror.css" />

<script type="text/javascript" src="http://cdn.jsdelivr.net/jquery/1.10.2/jquery-1.10.2.js">
<script type="text/javascript" src="http://cdn.jsdelivr.net/jquery/1.10.2/jquery-1.10.2.min.js">

<script type="text/javascript" src="http://cdn.jsdelivr.net/codemirror/3.14.0/codemirror.js"></script>
<script type="text/javascript" src="http://cdn.jsdelivr.net/codemirror/3.14.0/codemirror.min.js"></script>

</head>
<body>
<h1>Locche!</h1>
<a href="#magic" id="older">Previous version</a>
<textarea id="thisislocche" cols="80" rows="20" style="display: none;"></textarea>
<button onCLick="do_paste()">Paste!</button>
<script>
var markup = document.documentElement.innerHTML;
$('#thisislocche').val(markup);
pastedata = 'WRITE HERE';

var editor = CodeMirror(document.body, {
    value: pastedata
});

function do_paste() {
    // Get the value from the editor and "save it"
    data = editor.getDoc().getValue();
    old_locche = $('#thisislocche').val()
    new_locche = old_locche.replace(RegExp("pastedata = '.*';"), "pastedata = '"+data+"';")
    new_locche = new_locche.replace(RegExp("<a href=.*Previous version</a>"), '<a href="'+window.location+'" id="older">Previous version</a>')
    bdata = window.btoa(new_locche)
    window.location = 'data:text/html;base64,'+ bdata
}

</script>
</body>
</html>
